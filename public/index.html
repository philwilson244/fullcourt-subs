<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Fullcourt Subs</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700;800;900&family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
<style>
  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

  :root {
    --cyan: #FF6B2B;
    --cyan-mid: rgba(255,107,43,0.45);
    --cyan-dim: rgba(255,107,43,0.12);
    --cyan-ghost: rgba(255,107,43,0.05);
    --magenta: #FF2D78;
    --magenta-dim: rgba(255,45,120,0.15);
    --magenta-ghost: rgba(255,45,120,0.06);
    --orange: #FF6B2B;
    --orange-dim: rgba(255,107,43,0.12);
    --bg: #05060A;
    --surface-1: #0B0D14;
    --surface-2: #10131C;
    --surface-3: #181C28;
    --border: rgba(255,107,43,0.08);
    --border-glow: rgba(255,107,43,0.2);
    --text-1: #E8ECF4;
    --text-2: rgba(232,236,244,0.5);
    --text-3: rgba(232,236,244,0.22);
    --red: #FF3B4A;
  }

  html { font-size: 16px; }

  body {
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
    background: var(--bg);
    color: var(--text-1);
    min-height: 100dvh;
    -webkit-tap-highlight-color: transparent;
    overflow-x: hidden;
  }

  /* ── Background Grid + Glow ── */
  body::before {
    content: '';
    position: fixed;
    inset: 0;
    background:
      radial-gradient(ellipse 70% 50% at 50% 0%, rgba(255,107,43,0.04) 0%, transparent 70%),
      radial-gradient(ellipse 50% 40% at 80% 100%, rgba(255,45,120,0.03) 0%, transparent 60%);
    pointer-events: none;
    z-index: 0;
  }

  body::after {
    content: '';
    position: fixed;
    inset: 0;
    background-image:
      linear-gradient(rgba(255,107,43,0.015) 1px, transparent 1px),
      linear-gradient(90deg, rgba(255,107,43,0.015) 1px, transparent 1px);
    background-size: 40px 40px;
    pointer-events: none;
    z-index: 0;
  }

  /* ── Glow Keyframes ── */
  @keyframes pulse-cyan {
    0%, 100% { box-shadow: 0 0 12px rgba(255,107,43,0.15), inset 0 0 12px rgba(255,107,43,0.03); }
    50% { box-shadow: 0 0 24px rgba(255,107,43,0.3), inset 0 0 20px rgba(255,107,43,0.06); }
  }

  @keyframes pulse-border {
    0%, 100% { border-color: rgba(255,107,43,0.15); }
    50% { border-color: rgba(255,107,43,0.4); }
  }

  @keyframes pulse-magenta {
    0%, 100% { box-shadow: 0 0 12px rgba(255,45,120,0.12), inset 0 0 12px rgba(255,45,120,0.02); }
    50% { box-shadow: 0 0 24px rgba(255,45,120,0.25), inset 0 0 20px rgba(255,45,120,0.05); }
  }

  @keyframes scan-line {
    0% { transform: translateY(-100%); }
    100% { transform: translateY(100vh); }
  }

  @keyframes text-glow {
    0%, 100% { text-shadow: 0 0 8px rgba(255,107,43,0.3); }
    50% { text-shadow: 0 0 20px rgba(255,107,43,0.6), 0 0 40px rgba(255,107,43,0.2); }
  }

  @keyframes fadeSlideIn {
    from { opacity: 0; transform: translateY(8px); }
    to { opacity: 1; transform: translateY(0); }
  }

  /* ── Header ── */
  header {
    position: sticky;
    top: 0;
    z-index: 10;
    background: rgba(5,6,10,0.9);
    backdrop-filter: blur(24px);
    -webkit-backdrop-filter: blur(24px);
    border-bottom: 1px solid var(--border);
    padding: 12px 20px;
  }

  .header-inner {
    max-width: 500px;
    margin: 0 auto;
    display: flex;
    align-items: center;
    justify-content: space-between;
  }

  .brand {
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .brand-mark {
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
    opacity: 0.7;
  }

  .brand-mark img { height: 22px; width: auto; display: block; max-width: none; }

  .brand-wordmark {
    font-family: 'Orbitron', sans-serif;
    font-size: 0.85rem;
    font-weight: 900;
    letter-spacing: 3px;
    color: var(--cyan);
    text-shadow: 0 0 12px rgba(255,107,43,0.4);
  }

  .header-actions { display: flex; gap: 6px; }

  .pill-btn {
    background: var(--surface-2);
    border: 1px solid var(--border-glow);
    color: var(--cyan);
    padding: 6px 14px;
    border-radius: 4px;
    font-family: 'Orbitron', sans-serif;
    font-size: 0.55rem;
    font-weight: 700;
    letter-spacing: 1.5px;
    cursor: pointer;
    transition: all 0.15s;
    text-transform: uppercase;
  }

  .pill-btn:active {
    background: var(--cyan-dim);
    box-shadow: 0 0 12px rgba(255,107,43,0.2);
  }

  /* ── Header Menu (hamburger) ── */
  .header-menu-wrap { position: relative; z-index: 26; }

  .menu-trigger {
    width: 36px; height: 36px;
    display: flex; align-items: center; justify-content: center;
    background: var(--surface-2);
    border: 1px solid var(--border-glow);
    border-radius: 6px;
    color: var(--cyan);
    font-size: 1.2rem;
    font-weight: 700;
    cursor: pointer;
    transition: background 0.15s;
    -webkit-tap-highlight-color: transparent;
  }
  .menu-trigger:active { background: var(--cyan-dim); }

  .header-menu {
    display: none;
    position: absolute;
    top: calc(100% + 8px);
    right: 0;
    min-width: 160px;
    background: var(--surface-2);
    border: 1px solid var(--border-glow);
    border-radius: 6px;
    overflow: hidden;
    box-shadow: 0 8px 32px rgba(0,0,0,0.6);
    z-index: 25;
  }
  .header-menu.open { display: block; }

  .menu-item {
    display: block; width: 100%;
    padding: 14px 18px;
    background: none; border: none;
    font-family: 'Orbitron', sans-serif;
    font-size: 0.55rem; font-weight: 700;
    letter-spacing: 2px;
    text-transform: uppercase;
    color: var(--text-1);
    cursor: pointer;
    text-align: left;
    transition: background 0.12s;
    border-bottom: 1px solid var(--border);
  }
  .menu-item:last-child { border-bottom: none; }
  .menu-item:active { background: var(--cyan-dim); }
  .menu-item.menu-danger { color: var(--red); }
  .menu-item.menu-danger:active { background: rgba(255,59,74,0.1); }

  .menu-backdrop {
    display: none;
    position: fixed; inset: 0;
    z-index: 24;
  }
  .menu-backdrop.open { display: block; }

  /* ── Team Code Section ── */
  .team-code-section {
    margin-bottom: 28px;
    padding: 20px;
    background: var(--surface-1);
    border: 1px solid var(--border);
    border-radius: 8px;
    text-align: center;
  }
  .team-code-label {
    font-family: 'Orbitron', sans-serif;
    font-size: 0.55rem; font-weight: 700;
    letter-spacing: 2.5px; color: var(--text-2);
    margin-bottom: 14px; text-transform: uppercase;
  }
  .team-code-value {
    font-family: 'Orbitron', sans-serif;
    font-size: 1.8rem; font-weight: 900;
    letter-spacing: 8px; color: var(--cyan);
    text-shadow: 0 0 20px rgba(255,107,43,0.4);
    margin-bottom: 12px;
  }
  .team-code-actions { display: flex; gap: 8px; justify-content: center; }
  .code-btn {
    padding: 10px 20px;
    font-family: 'Orbitron', sans-serif;
    font-size: 0.5rem; font-weight: 700;
    letter-spacing: 2px; text-transform: uppercase;
    border: none; border-radius: 5px;
    cursor: pointer; transition: all 0.15s;
  }
  .code-btn:active { transform: scale(0.97); }
  .code-btn-primary {
    background: var(--cyan); color: var(--bg);
    box-shadow: 0 0 16px rgba(255,107,43,0.2);
  }
  .code-btn-secondary {
    background: var(--surface-3); color: var(--text-1);
    border: 1px solid var(--border-glow);
  }
  .code-btn-danger {
    background: none; color: var(--text-3);
    font-size: 0.45rem; padding: 6px 12px;
    text-decoration: underline; text-underline-offset: 3px;
  }
  .code-join-row {
    display: flex; gap: 8px; justify-content: center;
    margin-top: 12px;
  }
  .code-join-row.hidden { display: none; }
  .code-input {
    width: 140px; padding: 10px 12px;
    font-family: 'Orbitron', sans-serif;
    font-size: 1rem; font-weight: 800;
    letter-spacing: 4px; text-transform: uppercase;
    text-align: center;
    background: var(--surface-2); color: var(--text-1);
    border: 1px solid var(--border-glow); border-radius: 5px;
    outline: none;
  }
  .code-input:focus { border-color: var(--cyan); box-shadow: 0 0 12px rgba(255,107,43,0.15); }
  .code-input::placeholder { color: var(--text-3); letter-spacing: 2px; font-size: 0.6rem; }
  .code-error {
    font-size: 0.7rem; font-weight: 600;
    color: var(--red); margin-top: 8px;
  }
  .code-status {
    font-size: 0.6rem; font-weight: 600;
    color: var(--text-3); margin-top: 6px; letter-spacing: 0.5px;
  }
  .code-status.syncing { color: var(--cyan); }
  /* Connected state */
  .team-code-connected .team-code-value { margin-bottom: 8px; }

  /* ═══════════════════════════════
     SETUP SCREEN
     ═══════════════════════════════ */
  #setup-screen {
    position: relative; z-index: 1;
    max-width: 500px; margin: 0 auto;
    padding: 0 20px 40px;
  }

  .setup-hero {
    padding: 36px 0 30px;
    text-align: center;
  }

  .setup-hero h1 {
    font-family: 'Orbitron', sans-serif;
    font-size: 1.8rem;
    font-weight: 900;
    letter-spacing: 4px;
    text-transform: uppercase;
    line-height: 1.2;
    color: var(--text-1);
    text-shadow: 0 0 20px rgba(255,107,43,0.3);
  }

  .setup-hero h1 .glow {
    color: var(--cyan);
    text-shadow: 0 0 16px rgba(255,107,43,0.6), 0 0 40px rgba(255,107,43,0.2);
  }

  .setup-hero p {
    font-size: 0.78rem;
    color: var(--text-2);
    margin-top: 10px;
    line-height: 1.5;
  }

  /* ── Team Logo Upload ── */
  .logo-upload-area {
    display: flex;
    flex-direction: column;
    align-items: center;
    margin-bottom: 24px;
  }

  .logo-upload-trigger {
    width: 100%;
    height: 100px;
    border-radius: 8px;
    border: 2px dashed var(--border-glow);
    background: var(--surface-2);
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.2s;
    overflow: hidden;
    position: relative;
  }

  .logo-upload-trigger:active {
    border-color: var(--cyan);
    box-shadow: 0 0 20px rgba(255,107,43,0.2);
  }

  .logo-upload-trigger.has-image {
    border-style: solid;
    border-color: rgba(255,107,43,0.15);
  }

  .logo-upload-trigger img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .logo-upload-icon {
    color: var(--text-3);
    font-size: 1.8rem;
    line-height: 1;
  }

  .logo-upload-label {
    font-family: 'Orbitron', sans-serif;
    font-size: 0.45rem;
    font-weight: 700;
    letter-spacing: 2px;
    color: var(--text-3);
    margin-top: 8px;
    text-transform: uppercase;
  }

  .logo-upload-remove {
    background: none;
    border: none;
    color: var(--red);
    font-family: 'Orbitron', sans-serif;
    font-size: 0.45rem;
    font-weight: 700;
    letter-spacing: 1.5px;
    cursor: pointer;
    margin-top: 6px;
    padding: 4px 8px;
    text-transform: uppercase;
    display: none;
  }

  .logo-upload-area.has-logo .logo-upload-remove {
    display: block;
  }

  .logo-upload-area.has-logo .logo-upload-label {
    display: none;
  }

  /* ── Team Logo Banner (Rotation/Attendance) ── */
  .team-logo-banner {
    position: relative;
    width: 100%;
    height: 180px;
    overflow: hidden;
    display: none;
  }

  .team-logo-banner.visible {
    display: block;
  }

  .team-logo-banner img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    object-position: center;
  }

  .team-logo-banner::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    height: 80%;
    background: linear-gradient(to top, var(--bg) 0%, rgba(5,6,10,0.6) 50%, transparent 100%);
    pointer-events: none;
  }

  /* ── Team fields ── */
  .team-fields {
    display: flex; gap: 10px;
    margin-bottom: 24px;
  }

  .team-field {
    flex: 1;
  }

  .field-label {
    display: block;
    font-family: 'Orbitron', sans-serif;
    font-size: 0.5rem;
    font-weight: 700;
    letter-spacing: 2px;
    color: var(--text-3);
    margin-bottom: 6px;
    text-transform: uppercase;
  }

  .field-input {
    width: 100%;
    background: var(--surface-2);
    border: 1px solid var(--border-glow);
    border-radius: 6px;
    color: var(--text-1);
    font-family: 'Inter', sans-serif;
    font-size: 0.9rem;
    font-weight: 700;
    padding: 12px;
    transition: all 0.2s;
  }

  .field-input:focus {
    outline: none;
    border-color: var(--cyan);
    box-shadow: 0 0 16px rgba(255,107,43,0.15);
    background: var(--surface-1);
  }

  .field-input::placeholder { color: var(--text-3); }

  /* ── Game Format Steppers ── */
  .format-section { margin-bottom: 24px; }

  .format-label {
    font-family: 'Orbitron', sans-serif;
    font-size: 0.55rem;
    font-weight: 700;
    letter-spacing: 2.5px;
    color: var(--text-2);
    margin-bottom: 12px;
    text-transform: uppercase;
  }

  .format-fields { display: flex; gap: 10px; margin-bottom: 8px; }
  .format-field { flex: 1; }

  .stepper {
    display: flex;
    align-items: center;
    background: var(--surface-2);
    border: 1px solid var(--border-glow);
    border-radius: 6px;
    overflow: hidden;
  }

  .stepper-btn {
    width: 44px;
    padding: 12px 0;
    background: var(--surface-3);
    border: none;
    color: var(--cyan);
    font-size: 1.1rem;
    font-weight: 700;
    cursor: pointer;
    transition: background 0.15s;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .stepper-btn:active { background: var(--cyan-dim); }

  .stepper-val {
    flex: 1;
    text-align: center;
    font-family: 'Orbitron', sans-serif;
    font-size: 1.1rem;
    font-weight: 900;
    color: var(--text-1);
    padding: 12px 4px;
  }

  .format-summary {
    font-size: 0.7rem;
    font-weight: 600;
    color: var(--text-3);
    text-align: center;
    letter-spacing: 0.5px;
  }

  /* ── Numbered Player Slots ── */
  .roster-label {
    font-family: 'Orbitron', sans-serif;
    font-size: 0.55rem;
    font-weight: 700;
    letter-spacing: 2.5px;
    color: var(--text-2);
    margin-bottom: 12px;
    text-transform: uppercase;
  }

  .player-slots {
    display: flex;
    flex-direction: column;
    gap: 6px;
    margin-bottom: 8px;
  }

  .player-slot {
    display: flex;
    align-items: center;
    gap: 0;
    background: var(--surface-1);
    border: 1px solid var(--border);
    border-radius: 6px;
    overflow: hidden;
    transition: all 0.2s;
  }

  .player-slot:focus-within {
    border-color: var(--cyan);
    box-shadow: 0 0 16px rgba(255,107,43,0.12);
  }

  .slot-number {
    width: 44px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-family: 'Orbitron', sans-serif;
    font-size: 0.7rem;
    font-weight: 900;
    color: var(--cyan);
    background: var(--surface-2);
    border-right: 1px solid var(--border);
    align-self: stretch;
    text-shadow: 0 0 8px rgba(255,107,43,0.3);
    flex-shrink: 0;
  }

  .slot-input {
    flex: 1;
    background: transparent;
    border: none;
    color: var(--text-1);
    font-family: 'Inter', sans-serif;
    font-size: 1rem;
    font-weight: 800;
    padding: 14px 12px;
    letter-spacing: 0.3px;
  }

  .slot-input:focus { outline: none; }
  .slot-input::placeholder { color: var(--text-3); font-weight: 500; }

  .slot-remove {
    width: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: none;
    border: none;
    color: var(--text-3);
    font-size: 1.2rem;
    cursor: pointer;
    align-self: stretch;
    transition: color 0.15s;
  }

  .slot-remove:active { color: var(--red); }
  .slot-remove.hidden { visibility: hidden; }

  /* Add Player Button */
  .add-player-btn {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    width: 100%;
    padding: 14px;
    background: var(--cyan-ghost);
    border: 1px dashed rgba(255,107,43,0.2);
    border-radius: 6px;
    color: var(--cyan);
    font-family: 'Orbitron', sans-serif;
    font-size: 0.6rem;
    font-weight: 700;
    letter-spacing: 2px;
    text-transform: uppercase;
    cursor: pointer;
    transition: all 0.15s;
    margin-bottom: 20px;
  }

  .add-player-btn:active {
    background: var(--cyan-dim);
    box-shadow: 0 0 16px rgba(255,107,43,0.1);
  }

  .add-player-btn .plus {
    font-size: 1.1rem;
    font-weight: 400;
    line-height: 1;
  }

  .add-player-btn.disabled {
    opacity: 0.3;
    pointer-events: none;
  }

  .field-error {
    color: var(--red);
    font-size: 0.75rem;
    font-weight: 600;
    margin-bottom: 12px;
    min-height: 1.2em;
  }

  .start-btn {
    display: block;
    width: 100%;
    padding: 18px;
    background: var(--cyan);
    color: var(--bg);
    font-family: 'Orbitron', sans-serif;
    font-size: 0.8rem;
    font-weight: 900;
    letter-spacing: 4px;
    text-transform: uppercase;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    box-shadow: 0 0 30px rgba(255,107,43,0.3), 0 0 60px rgba(255,107,43,0.1);
    transition: transform 0.1s, box-shadow 0.2s;
  }

  .start-btn:active {
    transform: scale(0.98);
    box-shadow: 0 0 15px rgba(255,107,43,0.2);
  }

  /* ═══════════════════════════════
     ROTATION SCREEN
     ═══════════════════════════════ */
  #rotation-screen {
    display: none;
    position: relative; z-index: 1;
    max-width: 500px; margin: 0 auto;
    padding: 0 0 130px;
  }

  /* ── Team Header ── */
  .team-header {
    padding: 24px 20px 0;
    cursor: pointer;
    text-align: center;
    position: relative;
    z-index: 1;
  }

  .team-logo-banner.visible + .team-header {
    margin-top: -60px;
  }

  .team-tag {
    font-family: 'Orbitron', sans-serif;
    font-size: 0.5rem;
    font-weight: 700;
    letter-spacing: 3px;
    color: var(--text-3);
    text-transform: uppercase;
    margin-bottom: 8px;
  }

  .team-title {
    font-family: 'Orbitron', sans-serif;
    font-size: 1.5rem;
    font-weight: 900;
    letter-spacing: 2px;
    text-transform: uppercase;
    line-height: 1.15;
    color: var(--text-1);
    text-shadow: 0 0 16px rgba(255,107,43,0.2);
  }

  .team-title .glow {
    color: var(--cyan);
    text-shadow: 0 0 12px rgba(255,107,43,0.5), 0 0 30px rgba(255,107,43,0.15);
  }

  .team-sub {
    font-size: 0.72rem;
    font-weight: 500;
    color: var(--text-2);
    margin-top: 4px;
  }

  .team-edit-hint {
    font-size: 0.55rem;
    color: var(--text-3);
    margin-top: 8px;
    letter-spacing: 1px;
  }

  /* ── Stats Bar ── */
  .stats-bar {
    display: flex;
    margin: 20px 20px 0;
    border: 1px solid var(--border);
    border-radius: 6px;
    overflow: hidden;
    background: var(--surface-1);
  }

  .stat {
    flex: 1;
    text-align: center;
    padding: 14px 4px;
    position: relative;
  }

  .stat:not(:last-child)::after {
    content: '';
    position: absolute;
    right: 0; top: 10px; bottom: 10px;
    width: 1px;
    background: var(--border);
  }

  .stat-val {
    font-family: 'Orbitron', sans-serif;
    font-size: 1.3rem;
    font-weight: 900;
    color: var(--cyan);
    text-shadow: 0 0 10px rgba(255,107,43,0.3);
    line-height: 1;
  }

  .stat-lbl {
    font-size: 0.5rem;
    font-weight: 700;
    letter-spacing: 1.5px;
    text-transform: uppercase;
    color: var(--text-3);
    margin-top: 6px;
  }

  /* ── Section ── */
  .sec {
    padding: 20px;
  }

  .sec-head {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 12px;
  }

  .sec-icon {
    width: 28px; height: 28px;
    border-radius: 4px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-family: 'Orbitron', sans-serif;
    font-size: 0.6rem;
    font-weight: 900;
    flex-shrink: 0;
  }

  .sec-icon.court-icon {
    background: var(--cyan-dim);
    color: var(--cyan);
    border: 1px solid rgba(255,107,43,0.2);
    text-shadow: 0 0 6px rgba(255,107,43,0.4);
  }

  .sec-icon.deck-icon {
    background: var(--magenta-dim);
    color: var(--magenta);
    border: 1px solid rgba(255,45,120,0.2);
    text-shadow: 0 0 6px rgba(255,45,120,0.4);
  }

  .sec-title {
    font-family: 'Orbitron', sans-serif;
    font-size: 0.55rem;
    font-weight: 700;
    letter-spacing: 3px;
    text-transform: uppercase;
    color: var(--text-2);
  }

  .sec-line {
    flex: 1;
    height: 1px;
  }

  .sec-line.court-line { background: linear-gradient(90deg, rgba(255,107,43,0.15), transparent); }
  .sec-line.deck-line { background: linear-gradient(90deg, rgba(255,45,120,0.15), transparent); }

  /* ── Player Cards (Rotation View) ── */
  .p-grid {
    display: flex;
    flex-direction: column;
    gap: 4px;
  }

  .p-card {
    display: flex;
    align-items: center;
    gap: 0;
    border-radius: 5px;
    overflow: hidden;
    animation: fadeSlideIn 0.25s ease-out both;
  }

  .p-card:nth-child(2) { animation-delay: 0.04s; }
  .p-card:nth-child(3) { animation-delay: 0.08s; }
  .p-card:nth-child(4) { animation-delay: 0.12s; }
  .p-card:nth-child(5) { animation-delay: 0.16s; }

  .p-num {
    width: 38px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-family: 'Orbitron', sans-serif;
    font-size: 0.65rem;
    font-weight: 900;
    align-self: stretch;
    flex-shrink: 0;
  }

  .p-name {
    flex: 1;
    padding: 12px;
    font-size: 1.05rem;
    font-weight: 800;
    letter-spacing: 0.5px;
    text-transform: uppercase;
  }

  /* Court player card */
  .p-card.court-p {
    background: var(--surface-2);
    border: 1px solid rgba(255,107,43,0.15);
    animation-name: fadeSlideIn;
  }

  .p-card.court-p .p-num {
    background: var(--cyan-dim);
    color: var(--cyan);
    text-shadow: 0 0 8px rgba(255,107,43,0.4);
    border-right: 1px solid rgba(255,107,43,0.1);
  }

  .p-card.court-p .p-name {
    color: var(--text-1);
  }

  /* On-court glow on first card */
  .p-card.court-p:first-child {
    box-shadow: 0 0 12px rgba(255,107,43,0.08);
  }

  /* Deck player card */
  .p-card.deck-p {
    background: var(--surface-2);
    border: 1px solid rgba(255,45,120,0.12);
  }

  .p-card.deck-p .p-num {
    background: var(--magenta-dim);
    color: var(--magenta);
    text-shadow: 0 0 8px rgba(255,45,120,0.4);
    border-right: 1px solid rgba(255,45,120,0.08);
  }

  .p-card.deck-p .p-name {
    color: var(--text-2);
  }

  /* ── On Deck Section Pulse ── */
  .sec-deck {
    animation: pulse-magenta 3s ease-in-out infinite;
    border-top: 1px solid rgba(255,45,120,0.1);
    border-bottom: 1px solid rgba(255,45,120,0.1);
    background: var(--magenta-ghost);
  }

  /* ── Divider ── */
  .divider {
    height: 1px;
    background: var(--border);
  }

  /* ── Rotation Queue ── */
  .queue-label {
    font-family: 'Orbitron', sans-serif;
    font-size: 0.5rem;
    font-weight: 700;
    letter-spacing: 3px;
    text-transform: uppercase;
    color: var(--text-3);
    margin-bottom: 10px;
  }

  .q-grid { display: flex; flex-direction: column; gap: 4px; }

  .q-row {
    display: flex;
    align-items: center;
    gap: 0;
    border-radius: 5px;
    overflow: hidden;
    background: var(--surface-1);
    border: 1px solid var(--border);
    transition: all 0.2s;
  }

  .q-row.qa {
    border-color: rgba(255,107,43,0.3);
    box-shadow: 0 0 16px rgba(255,107,43,0.1);
  }

  .q-row.qd {
    border-color: rgba(255,45,120,0.2);
    background: var(--magenta-ghost);
  }

  .q-tag {
    width: 58px;
    padding: 10px 0;
    text-align: center;
    font-family: 'Orbitron', sans-serif;
    font-size: 0.45rem;
    font-weight: 800;
    letter-spacing: 1.5px;
    text-transform: uppercase;
    flex-shrink: 0;
    align-self: stretch;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .q-row.qa .q-tag {
    background: var(--cyan-dim);
    color: var(--cyan);
    text-shadow: 0 0 6px rgba(255,107,43,0.4);
    border-right: 1px solid rgba(255,107,43,0.1);
  }

  .q-row.qd .q-tag {
    background: var(--magenta-dim);
    color: var(--magenta);
    text-shadow: 0 0 6px rgba(255,45,120,0.4);
    border-right: 1px solid rgba(255,45,120,0.08);
  }

  .q-row:not(.qa):not(.qd) .q-tag {
    color: var(--text-3);
    border-right: 1px solid var(--border);
  }

  .q-names {
    flex: 1;
    padding: 10px 12px;
    font-size: 0.75rem;
    font-weight: 600;
  }

  .q-row.qa .q-names { color: var(--text-1); }
  .q-row.qd .q-names { color: var(--text-2); }
  .q-row:not(.qa):not(.qd) .q-names { color: var(--text-3); }

  /* ── Bottom Bar ── */
  .bottom-bar {
    position: fixed;
    bottom: 0; left: 0; right: 0;
    background: rgba(5,6,10,0.92);
    backdrop-filter: blur(24px);
    -webkit-backdrop-filter: blur(24px);
    border-top: 1px solid var(--border);
    padding: 14px 20px;
    padding-bottom: max(14px, env(safe-area-inset-bottom));
    z-index: 10;
    display: none;
  }

  .bottom-inner { max-width: 500px; margin: 0 auto; }

  .next-sub-btn {
    display: block;
    width: 100%;
    padding: 20px;
    background: var(--cyan);
    color: var(--bg);
    font-family: 'Orbitron', sans-serif;
    font-size: 0.9rem;
    font-weight: 900;
    letter-spacing: 5px;
    text-transform: uppercase;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    box-shadow: 0 0 30px rgba(255,107,43,0.3), 0 0 60px rgba(255,107,43,0.1);
    transition: transform 0.1s, box-shadow 0.2s;
    animation: pulse-cyan 3s ease-in-out infinite;
  }

  .next-sub-btn:active {
    transform: scale(0.97);
    box-shadow: 0 0 12px rgba(255,107,43,0.2);
    animation: none;
  }

  .next-sub-btn.game-over {
    background: var(--surface-3);
    color: var(--text-3);
    box-shadow: none;
    animation: none;
    cursor: default;
    letter-spacing: 4px;
  }

  .next-sub-btn.game-over:active {
    transform: none;
  }

  /* ═══════════════════════════════
     MODALS
     ═══════════════════════════════ */
  .modal-overlay {
    display: none;
    position: fixed; inset: 0;
    background: rgba(0,0,0,0.8);
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
    z-index: 20;
    align-items: flex-end;
    justify-content: center;
  }

  .modal-overlay.open { display: flex; }

  .modal {
    background: var(--surface-2);
    border-radius: 12px 12px 0 0;
    border-top: 1px solid var(--border-glow);
    width: 100%; max-width: 500px;
    padding: 20px;
    padding-bottom: max(24px, env(safe-area-inset-bottom));
    max-height: 85dvh;
    overflow-y: auto;
  }

  .modal-handle {
    width: 32px; height: 3px;
    border-radius: 2px;
    background: var(--surface-3);
    margin: 0 auto 18px;
  }

  .modal h2 {
    font-family: 'Orbitron', sans-serif;
    font-size: 0.55rem;
    font-weight: 700;
    letter-spacing: 3px;
    text-transform: uppercase;
    color: var(--cyan);
    text-shadow: 0 0 8px rgba(255,107,43,0.3);
    margin-bottom: 16px;
  }

  .modal .field-textarea {
    width: 100%; min-height: 180px;
    background: var(--surface-1);
    border: 1px solid var(--border-glow);
    border-radius: 6px;
    color: var(--text-1);
    font-family: 'Inter', sans-serif;
    font-size: 0.95rem;
    font-weight: 700;
    padding: 14px;
    resize: vertical;
    line-height: 1.75;
    transition: border-color 0.2s;
  }

  .modal .field-textarea:focus {
    outline: none;
    border-color: var(--cyan);
    box-shadow: 0 0 16px rgba(255,107,43,0.12);
  }

  .modal .field { margin-bottom: 12px; }

  .modal .field-input {
    background: var(--surface-1);
    border-color: var(--border-glow);
  }

  .modal-error {
    color: var(--red);
    font-size: 0.75rem;
    font-weight: 600;
    margin-top: 8px;
    min-height: 1.2em;
  }

  .modal-actions {
    display: flex; gap: 8px;
    margin-top: 18px;
  }

  .modal-actions button {
    flex: 1; padding: 14px;
    font-family: 'Orbitron', sans-serif;
    font-size: 0.55rem;
    font-weight: 700;
    letter-spacing: 2px;
    text-transform: uppercase;
    border: none; border-radius: 6px;
    cursor: pointer;
    transition: transform 0.1s;
  }

  .modal-actions button:active { transform: scale(0.98); }

  .btn-ghost {
    background: var(--surface-3);
    color: var(--text-2);
  }

  .btn-glow {
    background: var(--cyan);
    color: var(--bg);
    box-shadow: 0 0 16px rgba(255,107,43,0.2);
  }

  .btn-danger {
    background: rgba(255,59,74,0.15);
    color: var(--red);
    border: 1px solid rgba(255,59,74,0.3);
  }

  /* ═══════════════════════════════
     ATTENDANCE SCREEN
     ═══════════════════════════════ */
  #attendance-screen {
    display: none;
    position: relative; z-index: 1;
    max-width: 500px; margin: 0 auto;
    padding: 0 20px 40px;
  }

  .att-hero {
    padding: 30px 0 24px;
    text-align: center;
    position: relative;
    z-index: 1;
  }

  .team-logo-banner.visible + .att-hero {
    margin-top: -50px;
  }

  .att-hero h1 {
    font-family: 'Orbitron', sans-serif;
    font-size: 1.5rem;
    font-weight: 900;
    letter-spacing: 3px;
    text-transform: uppercase;
    color: var(--text-1);
    text-shadow: 0 0 16px rgba(255,107,43,0.25);
  }

  .att-hero h1 .glow {
    color: var(--cyan);
    text-shadow: 0 0 14px rgba(255,107,43,0.5), 0 0 30px rgba(255,107,43,0.15);
  }

  .att-hero p {
    font-size: 0.78rem;
    color: var(--text-2);
    margin-top: 8px;
    line-height: 1.5;
  }

  .att-count {
    text-align: center;
    margin-bottom: 18px;
    font-family: 'Orbitron', sans-serif;
    font-size: 0.6rem;
    font-weight: 700;
    letter-spacing: 2px;
    color: var(--text-3);
  }

  .att-count span {
    color: var(--cyan);
    text-shadow: 0 0 6px rgba(255,107,43,0.3);
  }

  .att-count.att-error { color: var(--red); }

  .att-list {
    display: flex;
    flex-direction: column;
    gap: 4px;
    margin-bottom: 20px;
  }

  .att-row {
    display: flex;
    align-items: center;
    gap: 0;
    background: var(--surface-1);
    border: 1px solid var(--border);
    border-radius: 6px;
    overflow: hidden;
    cursor: pointer;
    transition: all 0.15s;
    -webkit-user-select: none;
    user-select: none;
  }

  .att-row.present {
    border-color: rgba(255,107,43,0.2);
  }

  .att-row.absent {
    opacity: 0.4;
  }

  .att-num {
    width: 38px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-family: 'Orbitron', sans-serif;
    font-size: 0.65rem;
    font-weight: 900;
    color: var(--text-3);
    background: var(--surface-2);
    border-right: 1px solid var(--border);
    align-self: stretch;
    flex-shrink: 0;
  }

  .att-row.present .att-num {
    color: var(--cyan);
    text-shadow: 0 0 6px rgba(255,107,43,0.3);
  }

  .att-name {
    flex: 1;
    padding: 13px 12px;
    font-size: 1rem;
    font-weight: 800;
    text-transform: uppercase;
    letter-spacing: 0.3px;
  }

  .att-row.absent .att-name {
    text-decoration: line-through;
    color: var(--text-3);
  }

  .att-toggle {
    width: 44px;
    display: flex;
    align-items: center;
    justify-content: center;
    align-self: stretch;
    font-size: 1rem;
    flex-shrink: 0;
  }

  .att-row.present .att-toggle { color: var(--cyan); }
  .att-row.absent .att-toggle { color: var(--text-3); }

  .att-actions {
    display: flex;
    gap: 8px;
  }

  .att-actions button {
    flex: 1;
  }

  .att-btn-secondary {
    display: block;
    width: 100%;
    padding: 14px;
    background: var(--surface-3);
    color: var(--text-2);
    font-family: 'Orbitron', sans-serif;
    font-size: 0.6rem;
    font-weight: 700;
    letter-spacing: 2px;
    text-transform: uppercase;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    transition: transform 0.1s;
  }

  .att-btn-secondary:active { transform: scale(0.98); }

  /* ═══════════════════════════════
     RESET CONFIRM MODAL
     ═══════════════════════════════ */
  .confirm-body {
    text-align: center;
    padding: 10px 0 6px;
  }

  .confirm-icon {
    font-size: 2.2rem;
    margin-bottom: 12px;
    line-height: 1;
  }

  .confirm-msg {
    font-size: 0.85rem;
    font-weight: 600;
    color: var(--text-2);
    line-height: 1.5;
    margin-bottom: 4px;
  }

  .confirm-warn {
    font-size: 0.7rem;
    color: var(--red);
    font-weight: 600;
  }

  /* ═══════════════════════════════
     HISTORY MODAL
     ═══════════════════════════════ */
  .history-list {
    display: flex;
    flex-direction: column;
    gap: 8px;
    max-height: 55dvh;
    overflow-y: auto;
  }

  .history-entry {
    background: var(--surface-1);
    border: 1px solid var(--border);
    border-radius: 6px;
    overflow: hidden;
  }

  .history-header {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 10px 12px;
    background: var(--surface-2);
    border-bottom: 1px solid var(--border);
  }

  .history-badge {
    font-family: 'Orbitron', sans-serif;
    font-size: 0.5rem;
    font-weight: 800;
    letter-spacing: 1.5px;
    text-transform: uppercase;
    padding: 4px 8px;
    border-radius: 3px;
    background: var(--cyan-dim);
    color: var(--cyan);
    text-shadow: 0 0 6px rgba(255,107,43,0.3);
  }

  .history-sub-label {
    font-family: 'Orbitron', sans-serif;
    font-size: 0.5rem;
    font-weight: 700;
    letter-spacing: 1.5px;
    color: var(--text-3);
    text-transform: uppercase;
  }

  .history-body { padding: 10px 12px; }

  .history-row {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 3px 0;
  }

  .history-arrow {
    font-size: 0.7rem;
    flex-shrink: 0;
    width: 20px;
    text-align: center;
  }

  .history-arrow.on { color: var(--cyan); }
  .history-arrow.off { color: var(--magenta); }

  .history-players {
    font-size: 0.75rem;
    font-weight: 600;
    color: var(--text-2);
  }

  .history-empty {
    text-align: center;
    padding: 20px;
    color: var(--text-3);
    font-size: 0.8rem;
    font-weight: 600;
  }
</style>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>

<header>
  <div class="header-inner">
    <div class="brand">
      <div class="brand-mark">
        <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAiQAAAEqCAYAAAAlEUudAAAACXBIWXMAAAsTAAALEwEAmpwYAAALwmlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNy4yLWMwMDAgNzkuMWI2NWE3OWI0LCAyMDIyLzA2LzEzLTIyOjAxOjAxICAgICAgICAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIgeG1sbnM6cGhvdG9zaG9wPSJodHRwOi8vbnMuYWRvYmUuY29tL3Bob3Rvc2hvcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RFdnQ9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZUV2ZW50IyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtbG5zOnRpZmY9Imh0dHA6Ly9ucy5hZG9iZS5jb20vdGlmZi8xLjAvIiB4bWxuczpleGlmPSJodHRwOi8vbnMuYWRvYmUuY29tL2V4aWYvMS4wLyIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ0MgMjAxNyAoTWFjaW50b3NoKSIgeG1wOkNyZWF0ZURhdGU9IjIwMTctMDQtMjhUMTI6Mjk6MzYtMDc6MDAiIHhtcDpNb2RpZnlEYXRlPSIyMDIyLTEyLTAxVDEyOjM5OjMzLTA1OjAwIiB4bXA6TWV0YWRhdGFEYXRlPSIyMDIyLTEyLTAxVDEyOjM5OjMzLTA1OjAwIiBkYzpmb3JtYXQ9ImltYWdlL3BuZyIgcGhvdG9zaG9wOkNvbG9yTW9kZT0iMyIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDoxNGEyMGY1ZS1kYzQwLTRkYmItYmJkZC1kMWMwOTc1N2RmZjgiIHhtcE1NOkRvY3VtZW50SUQ9ImFkb2JlOmRvY2lkOnBob3Rvc2hvcDowODIxMTU2Ni1hODNkLTU2NDMtYjAzYS1iNTA2NDQ1ODE5N2UiIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDphMWFmYjMwZS01NzI2LTQ5YzktOWY5Ny0xM2I2YjRmNDgyYjAiIHRpZmY6T3JpZW50YXRpb249IjEiIHRpZmY6WFJlc29sdXRpb249IjcyMDAwMC8xMDAwMCIgdGlmZjpZUmVzb2x1dGlvbj0iNzIwMDAwLzEwMDAwIiB0aWZmOlJlc29sdXRpb25Vbml0PSIyIiBleGlmOkNvbG9yU3BhY2U9IjEiIGV4aWY6UGl4ZWxYRGltZW5zaW9uPSI1NDgiIGV4aWY6UGl4ZWxZRGltZW5zaW9uPSIyOTgiPiA8eG1wTU06SGlzdG9yeT4gPHJkZjpTZXE+IDxyZGY6bGkgc3RFdnQ6YWN0aW9uPSJjcmVhdGVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOmExYWZiMzBlLTU3MjYtNDljOS05Zjk3LTEzYjZiNGY0ODJiMCIgc3RFdnQ6d2hlbj0iMjAxNy0wNC0yOFQxMjoyOTozNi0wNzowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTcgKE1hY2ludG9zaCkiLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249ImNvbnZlcnRlZCIgc3RFdnQ6cGFyYW1ldGVycz0iZnJvbSBpbWFnZS9wbmcgdG8gYXBwbGljYXRpb24vdm5kLmFkb2JlLnBob3Rvc2hvcCIvPiA8cmRmOmxpIHN0RXZ0OmFjdGlvbj0ic2F2ZWQiIHN0RXZ0Omluc3RhbmNlSUQ9InhtcC5paWQ6ODNmY2Y1YmQtNThiZi00MWQxLWI4NDUtMDgyM2Q0OWZhODczIiBzdEV2dDp3aGVuPSIyMDE3LTA0LTI4VDEyOjMwOjM2LTA3OjAwIiBzdEV2dDpzb2Z0d2FyZUFnZW50PSJBZG9iZSBQaG90b3Nob3AgQ0MgMjAxNyAoTWFjaW50b3NoKSIgc3RFdnQ6Y2hhbmdlZD0iLyIvPiA8cmRmOmxpIHN0RXZ0OmFjdGlvbj0ic2F2ZWQiIHN0RXZ0Omluc3RhbmNlSUQ9InhtcC5paWQ6M2I1ZDhiMWUtYjRlNy00NzEzLTk4ZWYtYzMzM2ZjYTQ4NWEzIiBzdEV2dDp3aGVuPSIyMDE5LTAxLTExVDE1OjQyOjI2LTA4OjAwIiBzdEV2dDpzb2Z0d2FyZUFnZW50PSJBZG9iZSBQaG90b3Nob3AgQ0MgMjAxOCAoTWFjaW50b3NoKSIgc3RFdnQ6Y2hhbmdlZD0iLyIvPiA8cmRmOmxpIHN0RXZ0OmFjdGlvbj0iY29udmVydGVkIiBzdEV2dDpwYXJhbWV0ZXJzPSJmcm9tIGFwcGxpY2F0aW9uL3ZuZC5hZG9iZS5waG90b3Nob3AgdG8gaW1hZ2UvcG5nIi8+IDxyZGY6bGkgc3RFdnQ6YWN0aW9uPSJkZXJpdmVkIiBzdEV2dDpwYXJhbWV0ZXJzPSJjb252ZXJ0ZWQgZnJvbSBhcHBsaWNhdGlvbi92bmQuYWRvYmUucGhvdG9zaG9wIHRvIGltYWdlL3BuZyIvPiA8cmRmOmxpIHN0RXZ0OmFjdGlvbj0ic2F2ZWQiIHN0RXZ0Omluc3RhbmNlSUQ9InhtcC5paWQ6YmJkNWJmZDgtZTNhMy00MzgyLWExMGQtZGU1YjJkNTY5YmU5IiBzdEV2dDp3aGVuPSIyMDE5LTAxLTExVDE1OjQyOjI2LTA4OjAwIiBzdEV2dDpzb2Z0d2FyZUFnZW50PSJBZG9iZSBQaG90b3Nob3AgQ0MgMjAxOCAoTWFjaW50b3NoKSIgc3RFdnQ6Y2hhbmdlZD0iLyIvPiA8cmRmOmxpIHN0RXZ0OmFjdGlvbj0ic2F2ZWQiIHN0RXZ0Omluc3RhbmNlSUQ9InhtcC5paWQ6MTRhMjBmNWUtZGM0MC00ZGJiLWJiZGQtZDFjMDk3NTdkZmY4IiBzdEV2dDp3aGVuPSIyMDIyLTEyLTAxVDEyOjM5OjMzLTA1OjAwIiBzdEV2dDpzb2Z0d2FyZUFnZW50PSJBZG9iZSBQ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" alt="Fullcourt">
      </div>
      <div class="brand-wordmark">FULLCOURT</div>
    </div>
    <div class="header-actions" id="header-actions"></div>
  </div>
</header>

<!-- ═══ SETUP ═══ -->
<div id="setup-screen">
  <div class="setup-hero">
    <h1>BUILD YOUR<br><span class="glow">ROTATION</span></h1>
    <p>Add your team and players below. Tap + to add more slots.</p>
  </div>

  <div class="logo-upload-area" id="logo-upload-area">
    <div class="logo-upload-trigger" id="logo-upload-trigger">
      <div class="logo-upload-icon" id="logo-upload-icon">+</div>
    </div>
    <div class="logo-upload-label">TEAM LOGO</div>
    <button class="logo-upload-remove" id="logo-upload-remove" type="button">REMOVE</button>
  </div>
  <input type="file" id="logo-file-input" accept="image/*" style="display:none">

  <div class="team-code-section" id="team-code-section">
    <div class="team-code-label">TEAM SYNC</div>
    <!-- Disconnected state -->
    <div id="code-disconnected">
      <div class="team-code-actions">
        <button class="code-btn code-btn-primary" id="code-create-btn" type="button">CREATE TEAM</button>
        <button class="code-btn code-btn-secondary" id="code-join-toggle" type="button">JOIN TEAM</button>
      </div>
      <div class="code-join-row hidden" id="code-join-row">
        <input type="text" class="code-input" id="code-join-input" maxlength="6" placeholder="CODE" autocomplete="off" autocorrect="off" spellcheck="false">
        <button class="code-btn code-btn-primary" id="code-join-btn" type="button">GO</button>
      </div>
      <div class="code-error" id="code-error"></div>
    </div>
    <!-- Connected state -->
    <div id="code-connected" style="display:none">
      <div class="team-code-value" id="code-display"></div>
      <div class="team-code-actions">
        <button class="code-btn code-btn-secondary" id="code-copy-btn" type="button">COPY CODE</button>
        <button class="code-btn code-btn-danger" id="code-disconnect-btn" type="button">Disconnect</button>
      </div>
      <div class="code-status" id="code-status"></div>
    </div>
  </div>

  <div class="team-fields">
    <div class="team-field">
      <label class="field-label">Team Name</label>
      <input type="text" class="field-input" id="setup-team-name" placeholder="Wildcats" maxlength="40">
    </div>
    <div class="team-field">
      <label class="field-label">Subtitle</label>
      <input type="text" class="field-input" id="setup-team-subtitle" placeholder="Spring 2026" maxlength="60">
    </div>
  </div>

  <div class="format-section">
    <div class="format-label">GAME FORMAT</div>
    <div class="format-fields">
      <div class="format-field">
        <label class="field-label">Quarters</label>
        <div class="stepper">
          <button class="stepper-btn" id="quarters-minus" type="button">&minus;</button>
          <div class="stepper-val" id="quarters-val">4</div>
          <button class="stepper-btn" id="quarters-plus" type="button">+</button>
        </div>
      </div>
      <div class="format-field">
        <label class="field-label">Subs / Quarter</label>
        <div class="stepper">
          <button class="stepper-btn" id="subs-per-q-minus" type="button">&minus;</button>
          <div class="stepper-val" id="subs-per-q-val">1</div>
          <button class="stepper-btn" id="subs-per-q-plus" type="button">+</button>
        </div>
      </div>
    </div>
    <div class="format-summary" id="format-summary">4 quarters &times; 1 sub = 4 total subs</div>
  </div>

  <div class="roster-label">ROSTER</div>
  <div class="player-slots" id="player-slots"></div>
  <button class="add-player-btn" id="add-player-btn"><span class="plus">+</span> ADD PLAYER</button>

  <div class="field-error" id="roster-error"></div>
  <button class="start-btn" id="start-btn">LAUNCH</button>
</div>

<!-- ═══ ATTENDANCE ═══ -->
<div id="attendance-screen">
  <div class="team-logo-banner" id="attendance-logo"><img id="attendance-logo-img" src="" alt=""></div>
  <div class="att-hero">
    <h1>WHO'S <span class="glow">HERE?</span></h1>
    <p>Tap a player to mark them out. Only present players will be in today's rotation.</p>
  </div>
  <div class="att-count" id="att-count"></div>
  <div class="att-list" id="att-list"></div>
  <div class="att-actions">
    <button class="att-btn-secondary" id="att-back">BACK</button>
    <button class="start-btn" id="att-go" style="flex:1">START GAME</button>
  </div>
</div>

<!-- ═══ ROTATION ═══ -->
<div id="rotation-screen">
  <div class="team-logo-banner" id="rotation-logo"><img id="rotation-logo-img" src="" alt=""></div>
  <div class="team-header" id="team-banner">
    <div class="team-tag">SUBSTITUTION TRACKER</div>
    <div class="team-title" id="display-team-name">MY <span class="glow">TEAM</span></div>
    <div class="team-sub" id="display-team-subtitle"></div>
    <div class="team-edit-hint">TAP TO EDIT</div>
  </div>

  <div class="stats-bar">
    <div class="stat">
      <div class="stat-val" id="stat-quarter">Q1</div>
      <div class="stat-lbl">Quarter</div>
    </div>
    <div class="stat">
      <div class="stat-val" id="stat-players">0</div>
      <div class="stat-lbl">Players</div>
    </div>
    <div class="stat">
      <div class="stat-val" id="stat-subs">0</div>
      <div class="stat-lbl">Subs</div>
    </div>
    <div class="stat">
      <div class="stat-val" id="stat-remaining">0</div>
      <div class="stat-lbl">Left</div>
    </div>
  </div>

  <div class="sec">
    <div class="sec-head">
      <div class="sec-icon court-icon">01</div>
      <div class="sec-title">ON THE COURT</div>
      <div class="sec-line court-line"></div>
    </div>
    <div class="p-grid" id="court-players"></div>
  </div>

  <div class="sec sec-deck">
    <div class="sec-head">
      <div class="sec-icon deck-icon">02</div>
      <div class="sec-title">ON DECK</div>
      <div class="sec-line deck-line"></div>
    </div>
    <div class="p-grid" id="deck-players"></div>
  </div>

  <div class="sec">
    <div class="queue-label">FULL ROTATION</div>
    <div class="q-grid" id="rotation-list"></div>
  </div>
</div>

<!-- ── Bottom Bar ── -->
<div class="bottom-bar" id="bottom-bar">
  <div class="bottom-inner">
    <button class="next-sub-btn" id="next-sub-btn">NEXT SUB</button>
  </div>
</div>

<!-- ── Edit Roster Modal ── -->
<div class="modal-overlay" id="edit-modal">
  <div class="modal">
    <div class="modal-handle"></div>
    <h2>Edit Roster</h2>
    <div class="field">
      <textarea class="field-textarea" id="modal-roster"></textarea>
      <div class="modal-error" id="modal-error"></div>
    </div>
    <div class="modal-actions">
      <button class="btn-ghost" id="modal-cancel">Cancel</button>
      <button class="btn-glow" id="modal-save">Save</button>
    </div>
  </div>
</div>

<!-- ── Reset Confirm Modal ── -->
<div class="modal-overlay" id="reset-modal">
  <div class="modal">
    <div class="modal-handle"></div>
    <h2>Confirm Reset</h2>
    <div class="confirm-body">
      <div class="confirm-icon">&#9888;&#65039;</div>
      <div class="confirm-msg">This will clear the entire roster, team name, and all saved data. You'll start completely fresh.</div>
      <div class="confirm-warn">This cannot be undone.</div>
    </div>
    <div class="modal-actions">
      <button class="btn-ghost" id="reset-cancel">CANCEL</button>
      <button class="btn-danger" id="reset-confirm" style="flex:1">CLEAR EVERYTHING</button>
    </div>
  </div>
</div>

<!-- ── Edit Team Modal ── -->
<div class="modal-overlay" id="team-modal">
  <div class="modal">
    <div class="modal-handle"></div>
    <h2>Edit Team</h2>
    <div class="field">
      <label class="field-label">Team Name</label>
      <input type="text" class="field-input" id="modal-team-name" placeholder="Team name" maxlength="40">
    </div>
    <div class="field">
      <label class="field-label">Subtitle</label>
      <input type="text" class="field-input" id="modal-team-subtitle" placeholder="Season, league..." maxlength="60">
    </div>
    <div class="modal-actions">
      <button class="btn-ghost" id="team-modal-cancel">Cancel</button>
      <button class="btn-glow" id="team-modal-save">Save</button>
    </div>
  </div>
</div>

<!-- ── Substitution History Modal ── -->
<div class="modal-overlay" id="history-modal">
  <div class="modal">
    <div class="modal-handle"></div>
    <h2>Substitution History</h2>
    <div class="history-list" id="history-list"></div>
    <div class="history-empty" id="history-empty">No substitutions yet.</div>
    <div class="modal-actions">
      <button class="btn-ghost" id="history-close">Close</button>
    </div>
  </div>
</div>

<script>
(function() {
  var STORAGE_ROSTER = 'fullcourt_roster';
  var STORAGE_TEAM = 'fullcourt_team';
  var STORAGE_LOGO = 'fullcourt_logo';
  var STORAGE_GAME_FORMAT = 'fullcourt_game_format';
  var STORAGE_TEAM_CODE = 'fullcourt_team_code';

  // Supabase
  var SUPABASE_URL = 'https://tniyivhikkoxcmtzqoqw.supabase.co';
  var SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRuaXlpdmhpa2tveGNtdHpxb3F3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQwOTY3MTgsImV4cCI6MjA3OTY3MjcxOH0.QyjtnvNTOlE_vRk-l1NUoWX5bh6ew-yPSH3i2VhyoNY';
  var sb = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

  var GROUP_SIZE = 5;
  var MIN_SLOTS = 5;
  var MAX_PLAYERS = 15;

  // DOM refs
  var setupScreen = document.getElementById('setup-screen');
  var attendanceScreen = document.getElementById('attendance-screen');
  var rotationScreen = document.getElementById('rotation-screen');
  var bottomBar = document.getElementById('bottom-bar');
  var headerActions = document.getElementById('header-actions');
  var setupTeamName = document.getElementById('setup-team-name');
  var setupTeamSubtitle = document.getElementById('setup-team-subtitle');
  var playerSlotsContainer = document.getElementById('player-slots');
  var addPlayerBtn = document.getElementById('add-player-btn');
  var rosterError = document.getElementById('roster-error');
  var startBtn = document.getElementById('start-btn');
  var attList = document.getElementById('att-list');
  var attCount = document.getElementById('att-count');
  var attBack = document.getElementById('att-back');
  var attGo = document.getElementById('att-go');
  var displayTeamName = document.getElementById('display-team-name');
  var displayTeamSubtitle = document.getElementById('display-team-subtitle');
  var teamBanner = document.getElementById('team-banner');
  var courtPlayers = document.getElementById('court-players');
  var deckPlayers = document.getElementById('deck-players');
  var statQuarter = document.getElementById('stat-quarter');
  var statPlayers = document.getElementById('stat-players');
  var statSubs = document.getElementById('stat-subs');
  var statRemaining = document.getElementById('stat-remaining');
  var rotationList = document.getElementById('rotation-list');
  var nextSubBtn = document.getElementById('next-sub-btn');
  var editModal = document.getElementById('edit-modal');
  var modalRoster = document.getElementById('modal-roster');
  var modalError = document.getElementById('modal-error');
  var modalCancel = document.getElementById('modal-cancel');
  var modalSave = document.getElementById('modal-save');
  var teamModal = document.getElementById('team-modal');
  var modalTeamName = document.getElementById('modal-team-name');
  var modalTeamSubtitle = document.getElementById('modal-team-subtitle');
  var teamModalCancel = document.getElementById('team-modal-cancel');
  var teamModalSave = document.getElementById('team-modal-save');
  var resetModal = document.getElementById('reset-modal');
  var resetCancel = document.getElementById('reset-cancel');
  var resetConfirm = document.getElementById('reset-confirm');
  var logoUploadArea = document.getElementById('logo-upload-area');
  var logoUploadTrigger = document.getElementById('logo-upload-trigger');
  var logoUploadIcon = document.getElementById('logo-upload-icon');
  var logoUploadRemove = document.getElementById('logo-upload-remove');
  var logoFileInput = document.getElementById('logo-file-input');
  var rotationLogo = document.getElementById('rotation-logo');
  var rotationLogoImg = document.getElementById('rotation-logo-img');
  var attendanceLogo = document.getElementById('attendance-logo');
  var attendanceLogoImg = document.getElementById('attendance-logo-img');
  var quartersMinusBtn = document.getElementById('quarters-minus');
  var quartersPlusBtn = document.getElementById('quarters-plus');
  var quartersValEl = document.getElementById('quarters-val');
  var subsPerQMinusBtn = document.getElementById('subs-per-q-minus');
  var subsPerQPlusBtn = document.getElementById('subs-per-q-plus');
  var subsPerQValEl = document.getElementById('subs-per-q-val');
  var formatSummary = document.getElementById('format-summary');
  var historyModal = document.getElementById('history-modal');
  var historyList = document.getElementById('history-list');
  var historyEmpty = document.getElementById('history-empty');
  var historyCloseBtn = document.getElementById('history-close');
  var codeDisconnected = document.getElementById('code-disconnected');
  var codeConnected = document.getElementById('code-connected');
  var codeCreateBtn = document.getElementById('code-create-btn');
  var codeJoinToggle = document.getElementById('code-join-toggle');
  var codeJoinRow = document.getElementById('code-join-row');
  var codeJoinInput = document.getElementById('code-join-input');
  var codeJoinBtn = document.getElementById('code-join-btn');
  var codeError = document.getElementById('code-error');
  var codeDisplay = document.getElementById('code-display');
  var codeCopyBtn = document.getElementById('code-copy-btn');
  var codeDisconnectBtn = document.getElementById('code-disconnect-btn');
  var codeStatus = document.getElementById('code-status');

  // State
  var roster = [];       // full saved roster
  var activeRoster = []; // players present today
  var attendance = {};   // { name: true/false }
  var groups = [];
  var currentIndex = 0;
  var totalSubs = 0;
  var teamName = '';
  var teamSubtitle = '';
  var teamLogo = '';  // base64 data URL
  var slotCount = 10;
  var numQuarters = 4;
  var subsPerQuarter = 1;
  var subHistory = [];
  var teamCode = '';

  // ══════════════════════════════
  // SUPABASE SYNC
  // ══════════════════════════════

  function generateTeamCode() {
    var chars = 'ABCDEFGHJKLMNPQRSTUVWXYZ23456789'; // no 0/O/1/I confusion
    var code = '';
    for (var i = 0; i < 6; i++) code += chars.charAt(Math.floor(Math.random() * chars.length));
    return code;
  }

  function updateCodeUI() {
    if (teamCode) {
      codeDisconnected.style.display = 'none';
      codeConnected.style.display = '';
      codeDisplay.textContent = teamCode;
      codeError.textContent = '';
      codeJoinRow.classList.add('hidden');
    } else {
      codeDisconnected.style.display = '';
      codeConnected.style.display = 'none';
      codeJoinInput.value = '';
      codeError.textContent = '';
      codeStatus.textContent = '';
      codeJoinRow.classList.add('hidden');
    }
  }

  function setCodeStatus(msg, syncing) {
    codeStatus.textContent = msg;
    codeStatus.className = 'code-status' + (syncing ? ' syncing' : '');
  }

  function syncToSupabase() {
    if (!teamCode) return;
    setCodeStatus('Syncing...', true);
    sb.from('teams').update({
      team_name: teamName,
      team_subtitle: teamSubtitle,
      roster: roster,
      game_format: { quarters: numQuarters, subsPerQuarter: subsPerQuarter },
      logo: teamLogo,
      updated_at: new Date().toISOString()
    }).eq('team_code', teamCode).then(function(res) {
      if (res.error) { setCodeStatus('Sync failed', false); }
      else { setCodeStatus('Synced', false); setTimeout(function() { setCodeStatus('', false); }, 2000); }
    });
  }

  function syncFromSupabase(callback) {
    if (!teamCode) { if (callback) callback(false); return; }
    sb.from('teams').select('*').eq('team_code', teamCode).single().then(function(res) {
      if (res.error || !res.data) {
        // Team was deleted or code is invalid — clear local code
        teamCode = '';
        localStorage.removeItem(STORAGE_TEAM_CODE);
        updateCodeUI();
        if (callback) callback(false);
        return;
      }
      var d = res.data;
      teamName = d.team_name || '';
      teamSubtitle = d.team_subtitle || '';
      teamLogo = d.logo || '';
      roster = Array.isArray(d.roster) ? d.roster : [];
      if (d.game_format) {
        if (d.game_format.quarters >= 1 && d.game_format.quarters <= 8) numQuarters = d.game_format.quarters;
        if (d.game_format.subsPerQuarter >= 1 && d.game_format.subsPerQuarter <= 5) subsPerQuarter = d.game_format.subsPerQuarter;
      }
      // Cache locally
      localStorage.setItem(STORAGE_ROSTER, JSON.stringify(roster));
      localStorage.setItem(STORAGE_TEAM, JSON.stringify({ name: teamName, subtitle: teamSubtitle }));
      localStorage.setItem(STORAGE_GAME_FORMAT, JSON.stringify({ quarters: numQuarters, subsPerQuarter: subsPerQuarter }));
      if (teamLogo) localStorage.setItem(STORAGE_LOGO, teamLogo);
      else localStorage.removeItem(STORAGE_LOGO);
      if (callback) callback(true);
    });
  }

  function createTeam() {
    var code = generateTeamCode();
    codeError.textContent = '';
    codeCreateBtn.textContent = 'CREATING...';
    codeCreateBtn.disabled = true;

    sb.from('teams').insert({
      team_code: code,
      team_name: teamName,
      team_subtitle: teamSubtitle,
      roster: roster,
      game_format: { quarters: numQuarters, subsPerQuarter: subsPerQuarter },
      logo: teamLogo
    }).then(function(res) {
      codeCreateBtn.textContent = 'CREATE TEAM';
      codeCreateBtn.disabled = false;
      if (res.error) {
        codeError.textContent = 'Failed to create. Try again.';
        return;
      }
      teamCode = code;
      localStorage.setItem(STORAGE_TEAM_CODE, teamCode);
      updateCodeUI();
    });
  }

  function joinTeam() {
    var code = codeJoinInput.value.trim().toUpperCase();
    if (code.length !== 6) { codeError.textContent = 'Enter a 6-character code.'; return; }
    codeError.textContent = '';
    codeJoinBtn.textContent = '...';
    codeJoinBtn.disabled = true;

    sb.from('teams').select('*').eq('team_code', code).single().then(function(res) {
      codeJoinBtn.textContent = 'GO';
      codeJoinBtn.disabled = false;
      if (res.error || !res.data) {
        codeError.textContent = 'Team not found. Check the code.';
        return;
      }
      teamCode = code;
      localStorage.setItem(STORAGE_TEAM_CODE, teamCode);

      var d = res.data;
      teamName = d.team_name || '';
      teamSubtitle = d.team_subtitle || '';
      teamLogo = d.logo || '';
      roster = Array.isArray(d.roster) ? d.roster : [];
      if (d.game_format) {
        if (d.game_format.quarters >= 1 && d.game_format.quarters <= 8) numQuarters = d.game_format.quarters;
        if (d.game_format.subsPerQuarter >= 1 && d.game_format.subsPerQuarter <= 5) subsPerQuarter = d.game_format.subsPerQuarter;
      }
      // Cache locally
      localStorage.setItem(STORAGE_ROSTER, JSON.stringify(roster));
      localStorage.setItem(STORAGE_TEAM, JSON.stringify({ name: teamName, subtitle: teamSubtitle }));
      localStorage.setItem(STORAGE_GAME_FORMAT, JSON.stringify({ quarters: numQuarters, subsPerQuarter: subsPerQuarter }));
      if (teamLogo) localStorage.setItem(STORAGE_LOGO, teamLogo);
      else localStorage.removeItem(STORAGE_LOGO);

      updateCodeUI();
      // Refresh setup screen with new data
      showSetup();
    });
  }

  function disconnectTeam() {
    teamCode = '';
    localStorage.removeItem(STORAGE_TEAM_CODE);
    updateCodeUI();
  }

  // Team code event listeners
  codeCreateBtn.addEventListener('click', createTeam);
  codeJoinToggle.addEventListener('click', function() {
    codeJoinRow.classList.toggle('hidden');
    if (!codeJoinRow.classList.contains('hidden')) codeJoinInput.focus();
  });
  codeJoinBtn.addEventListener('click', joinTeam);
  codeJoinInput.addEventListener('keydown', function(e) { if (e.key === 'Enter') joinTeam(); });
  codeCopyBtn.addEventListener('click', function() {
    if (navigator.clipboard) {
      navigator.clipboard.writeText(teamCode).then(function() {
        codeCopyBtn.textContent = 'COPIED!';
        setTimeout(function() { codeCopyBtn.textContent = 'COPY CODE'; }, 1500);
      });
    }
  });
  codeDisconnectBtn.addEventListener('click', disconnectTeam);

  // ══════════════════════════════
  // SLOT MANAGEMENT (Setup Screen)
  // ══════════════════════════════

  function buildSlots(names) {
    playerSlotsContainer.innerHTML = '';
    var count = Math.max(MIN_SLOTS, names ? names.length : slotCount);
    if (count < 10 && !names.length) count = 10;
    slotCount = count;
    for (var i = 0; i < count; i++) {
      addSlotDOM(i + 1, names ? (names[i] || '') : '');
    }
    updateAddBtn();
  }

  function addSlotDOM(num, val) {
    var slot = document.createElement('div');
    slot.className = 'player-slot';

    var numEl = document.createElement('div');
    numEl.className = 'slot-number';
    numEl.textContent = num < 10 ? '0' + num : num;

    var input = document.createElement('input');
    input.type = 'text';
    input.className = 'slot-input';
    input.placeholder = 'Player ' + num;
    input.maxLength = 30;
    input.value = val;

    var removeBtn = document.createElement('button');
    removeBtn.className = 'slot-remove' + (num <= MIN_SLOTS ? ' hidden' : '');
    removeBtn.innerHTML = '&times;';
    removeBtn.type = 'button';
    removeBtn.addEventListener('click', function() {
      slot.remove();
      renumberSlots();
      updateAddBtn();
    });

    slot.appendChild(numEl);
    slot.appendChild(input);
    slot.appendChild(removeBtn);
    playerSlotsContainer.appendChild(slot);
  }

  function renumberSlots() {
    var slots = playerSlotsContainer.children;
    slotCount = slots.length;
    for (var i = 0; i < slots.length; i++) {
      var n = i + 1;
      slots[i].querySelector('.slot-number').textContent = n < 10 ? '0' + n : n;
      slots[i].querySelector('.slot-input').placeholder = 'Player ' + n;
      var rm = slots[i].querySelector('.slot-remove');
      if (n <= MIN_SLOTS) rm.classList.add('hidden');
      else rm.classList.remove('hidden');
    }
  }

  function updateAddBtn() {
    if (playerSlotsContainer.children.length >= MAX_PLAYERS) {
      addPlayerBtn.classList.add('disabled');
    } else {
      addPlayerBtn.classList.remove('disabled');
    }
  }

  function getSlotNames() {
    var inputs = playerSlotsContainer.querySelectorAll('.slot-input');
    var names = [];
    for (var i = 0; i < inputs.length; i++) {
      var v = inputs[i].value.trim();
      if (v) names.push(v);
    }
    return names;
  }

  addPlayerBtn.addEventListener('click', function() {
    if (playerSlotsContainer.children.length >= MAX_PLAYERS) return;
    slotCount++;
    addSlotDOM(slotCount, '');
    updateAddBtn();
    var lastInput = playerSlotsContainer.lastElementChild.querySelector('.slot-input');
    lastInput.focus();
  });

  // ══════════════════════════════
  // CORE LOGIC
  // ══════════════════════════════

  function validate(names) {
    if (names.length < 5) return 'You need at least 5 players.';
    if (names.length > 15) return 'Maximum 15 players allowed.';
    var seen = {};
    for (var i = 0; i < names.length; i++) {
      var key = names[i].toLowerCase();
      if (seen[key]) return 'Remove duplicate names.';
      seen[key] = true;
    }
    return null;
  }

  function buildGroups(names) {
    var numGroups = Math.ceil(names.length / GROUP_SIZE);
    var result = [];
    for (var g = 0; g < numGroups; g++) {
      var group = [];
      for (var i = 0; i < GROUP_SIZE; i++) {
        group.push(names[(g * GROUP_SIZE + i) % names.length]);
      }
      result.push(group);
    }
    return result;
  }

  function saveTeam() {
    localStorage.setItem(STORAGE_TEAM, JSON.stringify({ name: teamName, subtitle: teamSubtitle }));
    syncToSupabase();
  }

  function saveRoster() {
    localStorage.setItem(STORAGE_ROSTER, JSON.stringify(roster));
    syncToSupabase();
  }

  function saveLogo() {
    if (teamLogo) {
      localStorage.setItem(STORAGE_LOGO, teamLogo);
    } else {
      localStorage.removeItem(STORAGE_LOGO);
    }
    syncToSupabase();
  }

  function updateLogoUI() {
    // Setup screen upload trigger
    if (teamLogo) {
      logoUploadTrigger.classList.add('has-image');
      logoUploadTrigger.innerHTML = '<img src="' + teamLogo + '" alt="Team Logo">';
      logoUploadArea.classList.add('has-logo');
    } else {
      logoUploadTrigger.classList.remove('has-image');
      logoUploadTrigger.innerHTML = '<div class="logo-upload-icon" id="logo-upload-icon">+</div>';
      logoUploadArea.classList.remove('has-logo');
    }

    // Rotation screen logo
    if (teamLogo) {
      rotationLogoImg.src = teamLogo;
      rotationLogo.classList.add('visible');
      attendanceLogoImg.src = teamLogo;
      attendanceLogo.classList.add('visible');
    } else {
      rotationLogo.classList.remove('visible');
      attendanceLogo.classList.remove('visible');
    }
  }

  // Logo upload handlers
  logoUploadTrigger.addEventListener('click', function() {
    logoFileInput.click();
  });

  logoFileInput.addEventListener('change', function(e) {
    var file = e.target.files[0];
    if (!file) return;
    if (!file.type.startsWith('image/')) return;

    var reader = new FileReader();
    reader.onload = function(ev) {
      // Resize to fit localStorage while keeping good quality
      var img = new Image();
      img.onload = function() {
        var canvas = document.createElement('canvas');
        var maxW = 1200;
        var w = img.width;
        var h = img.height;
        if (w > maxW) { h = Math.round(h * maxW / w); w = maxW; }
        canvas.width = w;
        canvas.height = h;
        var ctx = canvas.getContext('2d');
        ctx.drawImage(img, 0, 0, w, h);
        teamLogo = canvas.toDataURL('image/jpeg', 0.92);
        saveLogo();
        updateLogoUI();
      };
      img.src = ev.target.result;
    };
    reader.readAsDataURL(file);
    logoFileInput.value = '';
  });

  logoUploadRemove.addEventListener('click', function(e) {
    e.stopPropagation();
    teamLogo = '';
    saveLogo();
    updateLogoUI();
  });

  function escHtml(s) {
    var d = document.createElement('div');
    d.textContent = s;
    return d.innerHTML;
  }

  function formatTeamTitle(name) {
    if (!name) return 'MY <span class="glow">TEAM</span>';
    var words = name.toUpperCase().split(' ');
    if (words.length === 1) return '<span class="glow">' + escHtml(words[0]) + '</span>';
    var last = words.pop();
    return escHtml(words.join(' ')) + ' <span class="glow">' + escHtml(last) + '</span>';
  }

  // ══════════════════════════════
  // SCREEN MANAGEMENT
  // ══════════════════════════════

  function hideAll() {
    setupScreen.style.display = 'none';
    attendanceScreen.style.display = 'none';
    rotationScreen.style.display = 'none';
    bottomBar.style.display = 'none';
    headerActions.innerHTML = '';
    // Clean up any menu backdrop
    var old = document.querySelector('.menu-backdrop');
    if (old) old.remove();
  }

  // ══════════════════════════════
  // GAME FORMAT HELPERS
  // ══════════════════════════════

  function getSubQuarter(subNumber) {
    return Math.floor((subNumber - 1) / subsPerQuarter) + 1;
  }

  function getSubWithinQuarter(subNumber) {
    return ((subNumber - 1) % subsPerQuarter) + 1;
  }

  function updateFormatUI() {
    quartersValEl.textContent = numQuarters;
    subsPerQValEl.textContent = subsPerQuarter;
    var total = numQuarters * subsPerQuarter;
    formatSummary.textContent = numQuarters + ' quarter' + (numQuarters !== 1 ? 's' : '') +
      ' \u00D7 ' + subsPerQuarter + ' sub' + (subsPerQuarter !== 1 ? 's' : '') +
      ' = ' + total + ' total sub' + (total !== 1 ? 's' : '');
  }

  function saveGameFormat() {
    localStorage.setItem(STORAGE_GAME_FORMAT, JSON.stringify({ quarters: numQuarters, subsPerQuarter: subsPerQuarter }));
    syncToSupabase();
  }

  function showSetup() {
    hideAll();
    setupScreen.style.display = 'block';
    buildSlots(roster);
    setupTeamName.value = teamName;
    setupTeamSubtitle.value = teamSubtitle;
    updateLogoUI();
    updateFormatUI();
    updateCodeUI();
  }

  // ══════════════════════════════
  // ATTENDANCE SCREEN
  // ══════════════════════════════

  function showAttendance() {
    hideAll();
    attendanceScreen.style.display = 'block';
    updateLogoUI();

    // Initialize all as present
    attendance = {};
    for (var i = 0; i < roster.length; i++) {
      attendance[roster[i]] = true;
    }
    renderAttendance();
  }

  function renderAttendance() {
    attList.innerHTML = '';
    var presentCount = 0;

    for (var i = 0; i < roster.length; i++) {
      var name = roster[i];
      var isPresent = attendance[name];
      if (isPresent) presentCount++;

      var row = document.createElement('div');
      row.className = 'att-row ' + (isPresent ? 'present' : 'absent');
      row.dataset.name = name;

      var num = document.createElement('div');
      num.className = 'att-num';
      var n = i + 1;
      num.textContent = n < 10 ? '0' + n : n;

      var nm = document.createElement('div');
      nm.className = 'att-name';
      nm.textContent = name;

      var toggle = document.createElement('div');
      toggle.className = 'att-toggle';
      toggle.textContent = isPresent ? '\u2713' : '\u2715';

      row.appendChild(num);
      row.appendChild(nm);
      row.appendChild(toggle);

      (function(playerName) {
        row.addEventListener('click', function() {
          attendance[playerName] = !attendance[playerName];
          renderAttendance();
        });
      })(name);

      attList.appendChild(row);
    }

    if (presentCount < 5) {
      attCount.className = 'att-count att-error';
      attCount.innerHTML = presentCount + ' / ' + roster.length + ' PRESENT \u2014 NEED AT LEAST 5';
    } else {
      attCount.className = 'att-count';
      attCount.innerHTML = '<span>' + presentCount + '</span> / ' + roster.length + ' PRESENT';
    }
  }

  function launchFromAttendance() {
    activeRoster = [];
    for (var i = 0; i < roster.length; i++) {
      if (attendance[roster[i]]) activeRoster.push(roster[i]);
    }
    if (activeRoster.length < 5) return; // button shouldn't work

    groups = buildGroups(activeRoster);
    currentIndex = 0;
    totalSubs = 0;
    subHistory = [];
    showRotation();
  }

  attBack.addEventListener('click', showSetup);
  attGo.addEventListener('click', launchFromAttendance);

  // ══════════════════════════════
  // ROTATION SCREEN
  // ══════════════════════════════

  function renderPlayerCards(container, names, cls) {
    container.innerHTML = '';
    for (var i = 0; i < names.length; i++) {
      var card = document.createElement('div');
      card.className = 'p-card ' + cls;

      var num = document.createElement('div');
      num.className = 'p-num';
      var n = i + 1;
      num.textContent = n < 10 ? '0' + n : n;

      var nm = document.createElement('div');
      nm.className = 'p-name';
      nm.textContent = names[i];

      card.appendChild(num);
      card.appendChild(nm);
      container.appendChild(card);
    }
  }

  function renderTeamBanner() {
    displayTeamName.innerHTML = formatTeamTitle(teamName);
    displayTeamSubtitle.textContent = teamSubtitle;
    displayTeamSubtitle.style.display = teamSubtitle ? '' : 'none';
  }

  function render() {
    var courtGroup = groups[currentIndex];
    var deckIndex = (currentIndex + 1) % groups.length;
    var deckGroup = groups[deckIndex];
    var totalExpectedSubs = numQuarters * subsPerQuarter;
    var remaining = totalExpectedSubs - totalSubs;
    var currentQ = totalSubs === 0 ? 1 : getSubQuarter(totalSubs);
    var gameOver = totalSubs >= totalExpectedSubs;

    renderPlayerCards(courtPlayers, courtGroup, 'court-p');
    renderPlayerCards(deckPlayers, deckGroup, 'deck-p');

    statQuarter.textContent = 'Q' + currentQ;
    statPlayers.textContent = activeRoster.length;
    statSubs.textContent = totalSubs;
    statRemaining.textContent = remaining;

    renderTeamBanner();

    // Update next-sub button label
    if (gameOver) {
      nextSubBtn.textContent = 'GAME OVER';
      nextSubBtn.classList.add('game-over');
    } else if (totalSubs === 0) {
      nextSubBtn.textContent = 'NEXT SUB';
      nextSubBtn.classList.remove('game-over');
    } else {
      var nextSubNum = totalSubs + 1;
      var nextQ = getSubQuarter(nextSubNum);
      var nextSubInQ = getSubWithinQuarter(nextSubNum);
      nextSubBtn.textContent = 'NEXT SUB \u2014 Q' + nextQ + ' SUB ' + nextSubInQ;
      nextSubBtn.classList.remove('game-over');
    }

    rotationList.innerHTML = '';
    for (var i = 0; i < groups.length; i++) {
      var row = document.createElement('div');
      row.className = 'q-row';

      var tag = '';
      if (i === currentIndex) { row.classList.add('qa'); tag = 'COURT'; }
      else if (i === deckIndex) { row.classList.add('qd'); tag = 'DECK'; }
      else { tag = 'GRP ' + (i + 1); }

      var tagEl = document.createElement('div');
      tagEl.className = 'q-tag';
      tagEl.textContent = tag;

      var namesEl = document.createElement('div');
      namesEl.className = 'q-names';
      namesEl.textContent = groups[i].join(', ');

      row.appendChild(tagEl);
      row.appendChild(namesEl);
      rotationList.appendChild(row);
    }
  }

  function showRotation() {
    hideAll();
    rotationScreen.style.display = 'block';
    bottomBar.style.display = 'block';
    updateLogoUI();

    // Hamburger menu
    var wrap = document.createElement('div');
    wrap.className = 'header-menu-wrap';

    var trigger = document.createElement('button');
    trigger.className = 'menu-trigger';
    trigger.innerHTML = '&#8942;'; // vertical ellipsis ⋮

    var menu = document.createElement('div');
    menu.className = 'header-menu';

    var backdrop = document.createElement('div');
    backdrop.className = 'menu-backdrop';

    function closeMenu() {
      menu.classList.remove('open');
      backdrop.classList.remove('open');
    }

    function makeItem(label, action, danger) {
      var btn = document.createElement('button');
      btn.className = 'menu-item' + (danger ? ' menu-danger' : '');
      btn.textContent = label;
      btn.addEventListener('click', function() {
        closeMenu();
        action();
      });
      return btn;
    }

    menu.appendChild(makeItem('History', openHistoryModal));
    menu.appendChild(makeItem('Roster', openEditModal));
    menu.appendChild(makeItem('Reset', openResetModal, true));

    trigger.addEventListener('click', function() {
      var isOpen = menu.classList.contains('open');
      if (isOpen) { closeMenu(); }
      else { menu.classList.add('open'); backdrop.classList.add('open'); }
    });

    backdrop.addEventListener('click', closeMenu);

    wrap.appendChild(trigger);
    wrap.appendChild(menu);
    headerActions.appendChild(wrap);
    document.body.appendChild(backdrop);

    render();
  }

  // ══════════════════════════════
  // ACTIONS
  // ══════════════════════════════

  function goToAttendance() {
    var names = getSlotNames();
    var err = validate(names);
    if (err) { rosterError.textContent = err; return; }
    rosterError.textContent = '';
    roster = names;
    teamName = setupTeamName.value.trim();
    teamSubtitle = setupTeamSubtitle.value.trim();
    saveRoster();
    saveTeam();
    saveGameFormat();
    showAttendance();
  }

  function nextSub() {
    var totalExpectedSubs = numQuarters * subsPerQuarter;
    if (totalSubs >= totalExpectedSubs) return;

    var prevGroup = groups[currentIndex].slice();
    currentIndex = (currentIndex + 1) % groups.length;
    totalSubs++;
    var newGroup = groups[currentIndex].slice();

    subHistory.push({
      subNumber: totalSubs,
      quarter: getSubQuarter(totalSubs),
      subInQuarter: getSubWithinQuarter(totalSubs),
      onCourt: newGroup,
      offCourt: prevGroup
    });

    render();
    window.scrollTo({ top: 0, behavior: 'smooth' });
  }

  // ── Reset (clears everything) ──

  function openResetModal() {
    resetModal.classList.add('open');
  }

  function closeResetModal() {
    resetModal.classList.remove('open');
  }

  function confirmReset() {
    roster = [];
    activeRoster = [];
    groups = [];
    currentIndex = 0;
    totalSubs = 0;
    teamName = '';
    teamSubtitle = '';
    teamLogo = '';
    numQuarters = 4;
    subsPerQuarter = 1;
    subHistory = [];
    teamCode = '';
    localStorage.removeItem(STORAGE_ROSTER);
    localStorage.removeItem(STORAGE_TEAM);
    localStorage.removeItem(STORAGE_LOGO);
    localStorage.removeItem(STORAGE_GAME_FORMAT);
    localStorage.removeItem(STORAGE_TEAM_CODE);
    closeResetModal();
    showSetup();
  }

  resetCancel.addEventListener('click', closeResetModal);
  resetConfirm.addEventListener('click', confirmReset);
  resetModal.addEventListener('click', function(e) { if (e.target === resetModal) closeResetModal(); });

  // ── Edit Roster Modal ──

  function openEditModal() {
    modalRoster.value = roster.join('\n');
    modalError.textContent = '';
    editModal.classList.add('open');
  }
  function closeEditModal() { editModal.classList.remove('open'); }
  function saveEditModal() {
    var names = modalRoster.value.split(/[\n,]+/).map(function(n){return n.trim();}).filter(function(n){return n.length>0;});
    var err = validate(names);
    if (err) { modalError.textContent = err; return; }
    roster = names;
    saveRoster();
    closeEditModal();
    showAttendance();
  }

  // ── Edit Team Modal ──

  function openTeamModal() {
    modalTeamName.value = teamName;
    modalTeamSubtitle.value = teamSubtitle;
    teamModal.classList.add('open');
  }
  function closeTeamModal() { teamModal.classList.remove('open'); }
  function saveTeamModal() {
    teamName = modalTeamName.value.trim();
    teamSubtitle = modalTeamSubtitle.value.trim();
    saveTeam();
    renderTeamBanner();
    closeTeamModal();
  }

  // ── History Modal ──

  function openHistoryModal() {
    renderHistory();
    historyModal.classList.add('open');
  }

  function closeHistoryModal() {
    historyModal.classList.remove('open');
  }

  function renderHistory() {
    historyList.innerHTML = '';
    if (subHistory.length === 0) {
      historyEmpty.style.display = '';
      return;
    }
    historyEmpty.style.display = 'none';

    for (var i = subHistory.length - 1; i >= 0; i--) {
      var entry = subHistory[i];

      var el = document.createElement('div');
      el.className = 'history-entry';

      var header = document.createElement('div');
      header.className = 'history-header';

      var badge = document.createElement('span');
      badge.className = 'history-badge';
      badge.textContent = 'Q' + entry.quarter;

      var label = document.createElement('span');
      label.className = 'history-sub-label';
      label.textContent = 'SUB ' + entry.subInQuarter + ' OF ' + subsPerQuarter;

      header.appendChild(badge);
      header.appendChild(label);

      var body = document.createElement('div');
      body.className = 'history-body';

      var onRow = document.createElement('div');
      onRow.className = 'history-row';
      var onArrow = document.createElement('span');
      onArrow.className = 'history-arrow on';
      onArrow.textContent = '\u25B2';
      var onNames = document.createElement('span');
      onNames.className = 'history-players';
      onNames.textContent = entry.onCourt.join(', ');
      onRow.appendChild(onArrow);
      onRow.appendChild(onNames);

      var offRow = document.createElement('div');
      offRow.className = 'history-row';
      var offArrow = document.createElement('span');
      offArrow.className = 'history-arrow off';
      offArrow.textContent = '\u25BC';
      var offNames = document.createElement('span');
      offNames.className = 'history-players';
      offNames.textContent = entry.offCourt.join(', ');
      offRow.appendChild(offArrow);
      offRow.appendChild(offNames);

      body.appendChild(onRow);
      body.appendChild(offRow);

      el.appendChild(header);
      el.appendChild(body);
      historyList.appendChild(el);
    }
  }

  historyCloseBtn.addEventListener('click', closeHistoryModal);
  historyModal.addEventListener('click', function(e) { if (e.target === historyModal) closeHistoryModal(); });

  // ══════════════════════════════
  // EVENT BINDINGS
  // ══════════════════════════════

  startBtn.addEventListener('click', goToAttendance);
  nextSubBtn.addEventListener('click', nextSub);
  modalCancel.addEventListener('click', closeEditModal);
  modalSave.addEventListener('click', saveEditModal);
  teamBanner.addEventListener('click', openTeamModal);
  teamModalCancel.addEventListener('click', closeTeamModal);
  teamModalSave.addEventListener('click', saveTeamModal);
  editModal.addEventListener('click', function(e) { if (e.target === editModal) closeEditModal(); });
  teamModal.addEventListener('click', function(e) { if (e.target === teamModal) closeTeamModal(); });

  // Stepper controls
  quartersMinusBtn.addEventListener('click', function() {
    if (numQuarters > 1) { numQuarters--; updateFormatUI(); }
  });
  quartersPlusBtn.addEventListener('click', function() {
    if (numQuarters < 8) { numQuarters++; updateFormatUI(); }
  });
  subsPerQMinusBtn.addEventListener('click', function() {
    if (subsPerQuarter > 1) { subsPerQuarter--; updateFormatUI(); }
  });
  subsPerQPlusBtn.addEventListener('click', function() {
    if (subsPerQuarter < 5) { subsPerQuarter++; updateFormatUI(); }
  });

  // ══════════════════════════════
  // INIT
  // ══════════════════════════════

  function loadLocalState() {
    var savedTeam = localStorage.getItem(STORAGE_TEAM);
    if (savedTeam) {
      try {
        var t = JSON.parse(savedTeam);
        teamName = t.name || '';
        teamSubtitle = t.subtitle || '';
      } catch (e) {}
    }

    var savedLogo = localStorage.getItem(STORAGE_LOGO);
    if (savedLogo) {
      teamLogo = savedLogo;
    }

    var savedFormat = localStorage.getItem(STORAGE_GAME_FORMAT);
    if (savedFormat) {
      try {
        var f = JSON.parse(savedFormat);
        if (f.quarters >= 1 && f.quarters <= 8) numQuarters = f.quarters;
        if (f.subsPerQuarter >= 1 && f.subsPerQuarter <= 5) subsPerQuarter = f.subsPerQuarter;
      } catch (e) {}
    }

    var savedRoster = localStorage.getItem(STORAGE_ROSTER);
    if (savedRoster) {
      try {
        var parsed = JSON.parse(savedRoster);
        if (Array.isArray(parsed) && parsed.length >= 5) {
          roster = parsed;
          return true; // has roster
        }
      } catch (e) {}
    }
    return false; // no roster
  }

  function finishInit() {
    if (roster.length >= 5) {
      showAttendance();
    } else {
      showSetup();
    }
  }

  // Load from localStorage first
  loadLocalState();

  // Check for saved team code and sync from Supabase
  var savedCode = localStorage.getItem(STORAGE_TEAM_CODE);
  if (savedCode) {
    teamCode = savedCode;
    // Pull latest from Supabase, then show appropriate screen
    syncFromSupabase(function() {
      finishInit();
    });
  } else {
    finishInit();
  }
})();
</script>
</body>
</html>
